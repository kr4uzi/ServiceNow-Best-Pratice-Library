<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_macro">
    <sys_ui_macro action="INSERT_OR_UPDATE">
        <active>true</active>
        <category>general</category>
        <description>Classic UI counterpart to the following Service Portal UI Formatter (with a record watcher):&#13;
/nav_to.do?uri=sp_widget.do?sys_id=ea24f18a972e1110d545b18e6253afc0&#13;
/nav_to.do?uri=sp_ui_formatter.do?sys_id=af14b5ce97ea1110d545b18e6253afab</description>
        <media_type/>
        <name>demo_ui_formatter_macro</name>
        <scoped_name>x_376096_bpl_demo_ui_formatter_macro</scoped_name>
        <sys_class_name>sys_ui_macro</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2022-10-16 11:20:10</sys_created_on>
        <sys_id>9b796102972e1110d545b18e6253afa4</sys_id>
        <sys_name>demo_ui_formatter_macro</sys_name>
        <sys_package display_value="Best Practice Library" source="x_376096_bpl">53c8084a8702111021d6fcc5dabb35d9</sys_package>
        <sys_policy/>
        <sys_scope display_value="Best Practice Library">53c8084a8702111021d6fcc5dabb35d9</sys_scope>
        <sys_update_name>sys_ui_macro_9b796102972e1110d545b18e6253afa4</sys_update_name>
        <xml><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
	<j2:if test="$[!current.isNewRecord()]">
		<div id='${ref}'>Record watcher: $[current.name.toString()]</div>
		<script>
			addLoadEvent(function () {		
				var ambClient = window.g_ambClient || window.top.g_ambClient;
				var table = '$[current.getTableName()]';
				var sys_id = '$[current.getUniqueValue()]';

				var watcherChannel = ambClient.getChannel('/rw/default/' + table + '/' + getFilterString('sys_id=' + sys_id));
				watcherChannel.subscribe(function(message) {
					if (message.data.operation === "update" $[AMP]$[AMP] message.data.changes.indexOf('name') > -1) {
						window.document.getElementById('${ref}').innerHTML = 'Record watcher: ' + message.data.record.name.value;
					}
				});

				function getFilterString(filter) {
					filter = filter.replace(/\^EQ/g, '').replace(/\^ORDERBY(?:DESC)?[^^]*/g, '').replace(/^GOTO/, '');
					return btoa(unescape(encodeURIComponent(filter))).replace(/=/g, '-');
				}
			});
		</script>
	</j2:if>
</j:jelly>]]></xml>
    </sys_ui_macro>
</record_update>
